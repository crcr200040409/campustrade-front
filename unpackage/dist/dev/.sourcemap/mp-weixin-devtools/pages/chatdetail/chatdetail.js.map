{"version":3,"names":["myId","common_vendor","ref","Math","random","toString","substr","messages","reactive","newMessage","scrollTop","scrollHeight","options","userName","onLoad","params","value","loadMessages","calcScrollHeight","systemInfo","index","getSystemInfoSync","query","createSelectorQuery","in","_this","select","boundingClientRect","exec","res","headerHeight","_a","height","inputHeight","_b","windowHeight","mockMessages","sender","sellerId","content","time","Date","now","push","apply","scrollToBottom","sendMessage","trim","newMsg","setTimeout","replyMsg","nextTick$1","formatTime","date","d","toLocaleTimeString","hour","minute","goBack","navigateBack","wx","createPage","_sfc_main"],"sources":["chatdetail.vue","cGFnZXMvY2hhdGRldGFpbC9jaGF0ZGV0YWlsLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"chat-container\">\n    <!-- 头部 -->\n    <view class=\"chat-header\">\n      <uni-icons\n          type=\"arrowleft\"\n          size=\"24\"\n          color=\"#333\"\n          @click=\"goBack\"\n          class=\"back-icon\"\n      ></uni-icons>\n      <text class=\"user-name\">{{ userName }}</text>\n    </view>\n\n    <!-- 消息列表 -->\n    <scroll-view\n        class=\"message-list\"\n        scroll-y\n        :scroll-top=\"scrollTop\"\n        :style=\"{ height: scrollHeight + 'px' }\"\n    >\n      <view\n          v-for=\"(message, index) in messages\"\n          :key=\"index\"\n          class=\"message-item\"\n          :class=\"message.sender === myId ? 'me' : 'other'\"\n      >\n        <view class=\"message-bubble\">\n          <text class=\"message-text\">{{ message.content }}</text>\n          <text class=\"message-time\">{{ formatTime(message.time) }}</text>\n        </view>\n      </view>\n    </scroll-view>\n\n    <!-- 输入区 -->\n    <view class=\"chat-input-area\">\n      <input\n          v-model=\"newMessage\"\n          type=\"text\"\n          placeholder=\"请输入消息\"\n          :adjust-position=\"false\"\n          @confirm=\"sendMessage\"\n          class=\"message-input\"\n      />\n      <button\n          @click=\"sendMessage\"\n          :disabled=\"!newMessage.trim()\"\n          class=\"send-button\"\n      >发送</button>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, reactive, onMounted, nextTick } from 'vue'\nimport { onLoad } from '@dcloudio/uni-app'\n\nconst myId = ref('user_' + Math.random().toString(36).substr(2, 4)) // 模拟用户ID\nconst messages = reactive([])\nconst newMessage = ref('')\n\n// 滚动控制\nconst scrollTop = ref(0)\nconst scrollHeight = ref(0)\n\n// 页面参数\nconst options = ref({})\nconst userName = ref('')\n\nonLoad((params) => {\n  options.value = params\n  userName.value = params.userName || '用户'\n\n  // 加载初始消息\n  loadMessages()\n\n  // 设置滚动区域高度\n  calcScrollHeight()\n})\n\n// 计算滚动区域高度\nconst calcScrollHeight = () => {\n  const systemInfo = uni.getSystemInfoSync()\n  const query = uni.createSelectorQuery().in(this)\n  query.select('.chat-header').boundingClientRect()\n  query.select('.chat-input-area').boundingClientRect()\n  query.exec(res => {\n    const headerHeight = res[0]?.height || 50\n    const inputHeight = res[1]?.height || 60\n    scrollHeight.value = systemInfo.windowHeight - headerHeight - inputHeight\n  })\n}\n\n// 加载初始消息\nconst loadMessages = () => {\n  // 模拟初始消息\n  const mockMessages = [\n    {\n      sender: options.value.sellerId || 'seller_123',\n      content: '您好，有什么可以帮您的吗？',\n      time: new Date(Date.now() - 60000)\n    },\n    {\n      sender: myId.value,\n      content: '我想咨询一下这个商品',\n      time: new Date(Date.now() - 30000)\n    }\n  ]\n\n  messages.push(...mockMessages)\n  scrollToBottom()\n}\n\n// 发送消息\nconst sendMessage = () => {\n  const content = newMessage.value.trim()\n  if (!content) return\n\n  const newMsg = {\n    sender: myId.value,\n    content,\n    time: new Date()\n  }\n\n  messages.push(newMsg)\n  newMessage.value = ''\n  scrollToBottom()\n\n  // 模拟回复\n  setTimeout(() => {\n    const replyMsg = {\n      sender: options.value.sellerId || 'seller_123',\n      content: '收到您的消息，我会尽快回复您',\n      time: new Date()\n    }\n    messages.push(replyMsg)\n    scrollToBottom()\n  }, 1000)\n}\n\n// 滚动到底部\nconst scrollToBottom = () => {\n  nextTick(() => {\n    scrollTop.value = 999999\n  })\n}\n\n// 格式化时间\nconst formatTime = (date) => {\n  if (!date) return ''\n  const d = new Date(date)\n  return d.toLocaleTimeString('zh', { hour: '2-digit', minute: '2-digit' })\n}\n\n// 返回上一页\nconst goBack = () => {\n  uni.navigateBack()\n}\n</script>\n\n<style lang=\"scss\">\n.chat-container {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  background-color: #f5f5f5;\n}\n\n.chat-header {\n  display: flex;\n  align-items: center;\n  padding: 15px;\n  background-color: #fff;\n  border-bottom: 1px solid #eee;\n\n  .back-icon {\n    margin-right: 10px;\n  }\n\n  .user-name {\n    font-size: 18px;\n    font-weight: 600;\n    color: #333;\n  }\n}\n\n.message-list {\n  flex: 1;\n  padding: 10px 15px;\n  box-sizing: border-box;\n  background-color: #f5f5f5;\n}\n\n.message-item {\n  margin-bottom: 15px;\n\n  &.me {\n    display: flex;\n    justify-content: flex-end;\n\n    .message-bubble {\n      background-color: #1d9bf0;\n      border-top-right-radius: 0;\n\n      .message-text {\n        color: #fff;\n      }\n\n      .message-time {\n        color: rgba(255, 255, 255, 0.7);\n      }\n    }\n  }\n\n  &.other {\n    display: flex;\n    justify-content: flex-start;\n\n    .message-bubble {\n      background-color: #fff;\n      border-top-left-radius: 0;\n      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n    }\n  }\n}\n\n.message-bubble {\n  max-width: 70%;\n  padding: 10px 12px;\n  border-radius: 8px;\n}\n\n.message-text {\n  font-size: 16px;\n  line-height: 1.4;\n}\n\n.message-time {\n  display: block;\n  font-size: 12px;\n  margin-top: 4px;\n  text-align: right;\n  color: #999;\n}\n\n.chat-input-area {\n  display: flex;\n  padding: 10px;\n  background-color: #fff;\n  border-top: 1px solid #eee;\n\n  .message-input {\n    flex: 1;\n    padding: 8px 12px;\n    background-color: #f5f5f5;\n    border-radius: 20px;\n    margin-right: 10px;\n    font-size: 16px;\n  }\n\n  .send-button {\n    background-color: #1d9bf0;\n    color: #fff;\n    border: none;\n    border-radius: 20px;\n    padding: 0 20px;\n    font-size: 14px;\n\n    &:disabled {\n      background-color: #ccc;\n      color: #999;\n    }\n  }\n}\n</style>","import MiniProgramPage from 'D:/作业/软件工程/课程设计/campustrade/code/campustrade-front/pages/chatdetail/chatdetail.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}