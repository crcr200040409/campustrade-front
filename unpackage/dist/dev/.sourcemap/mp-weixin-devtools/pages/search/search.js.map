{"version":3,"names":["searchValue","common_vendor","ref","useRoute","productList","searchPerformed","userStore","stores_user","useUserStore","recentSearches","getRecentSearches","priceMin","priceMax","priceSort","dateSort","handleSearch","_ref","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","payload","res","wrap","_callee$","_context","prev","next","value","trim","abrupt","index","setStorageSync","addSearchRecord","labelId","commodityPriceMin","commodityPriceMax","commodityKeyWord","commodityStatus","pageDTO","pageSize","pageIndex","api_request","request","url","method","data","sent","code","showToast","title","icon","t0","__f__","stop","apply","arguments","viewProductDetail","id","navigateTo","concat","handleTagClick","removeSearchItem","showModal","content","success","confirm","removeSearchRecord","clearHistory","clearSearchHistory","input","cancel","blur","focus","clear","onMounted","storedSearchValue","getStorageSync","wx","createPage","MiniProgramPage"],"sources":["search.vue","cGFnZXMvc2VhcmNoL3NlYXJjaC52dWU"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 搜索框 -->\n    <uni-search-bar\n        @confirm=\"handleSearch\"\n        :focus=\"true\"\n        v-model=\"searchValue\"\n        @blur=\"blur\"\n        @focus=\"focus\"\n        @input=\"input\"\n        @cancel=\"cancel\"\n        @clear=\"clear\"\n    ></uni-search-bar>\n\n    <!-- 筛选项 -->\n    <view class=\"filters\">\n      <view class=\"filter-group\">\n        <text class=\"label\">价格区间：</text>\n        <input class=\"input\" type=\"number\" v-model.number=\"priceMin\" placeholder=\"最小价格\" />\n        <text class=\"to\">-</text>\n        <input class=\"input\" type=\"number\" v-model.number=\"priceMax\" placeholder=\"最大价格\" />\n      </view>\n      <view class=\"filter-group\">\n        <text class=\"label\">价格排序：</text>\n        <switch @change=\"e => priceSort = e.detail.value\" :checked=\"priceSort\" />\n        <text>{{ priceSort ? '升序' : '降序' }}</text>\n      </view>\n      <view class=\"filter-group\">\n        <text class=\"label\">时间排序：</text>\n        <switch @change=\"e => dateSort = e.detail.value\" :checked=\"dateSort\" />\n        <text>{{ dateSort ? '升序' : '降序' }}</text>\n      </view>\n    </view>\n\n    <!-- 最近搜索 -->\n    <view class=\"section\" v-if=\"recentSearches.length > 0\">\n      <view class=\"section-header\">\n        <text class=\"section-title\">最近搜索</text>\n        <text class=\"clear-btn\" @click=\"clearHistory\">清空</text>\n      </view>\n      <view class=\"search-tags\">\n        <view\n            class=\"tag\"\n            v-for=\"(item, index) in recentSearches\"\n            :key=\"index\"\n            @click=\"handleTagClick(item)\"\n            @longpress=\"removeSearchItem(index)\"\n        >\n          {{ item }}\n        </view>\n      </view>\n    </view>\n    <!-- 搜索结果展示 -->\n    <view class=\"result-list\" v-if=\"productList.length\">\n      <view\n          class=\"result-item\"\n          v-for=\"(item, index) in productList\"\n          :key=\"item.commodityId\"\n          @click=\"viewProductDetail(item.commodityId)\"\n      >\n        <image\n            :src=\"item.commodityPhoto || '/images/default.jpg'\"\n            class=\"result-image\"\n            mode=\"aspectFill\"\n        />\n        <view class=\"result-info\">\n          <text class=\"result-title\">{{ item.commodityName }}</text>\n          <text class=\"result-desc\">{{ item.commodityDescription }}</text>\n          <text class=\"result-price\">¥{{ item.commodityPrice.toFixed(2) }}</text>\n        </view>\n      </view>\n    </view>\n\n    <view v-else-if=\"searchPerformed\" class=\"empty-tip\">\n      暂无匹配商品结果\n    </view>\n  </view>\n\n</template>\n\n\n<script setup>\nimport { onMounted, ref } from 'vue';\nconst searchValue = ref('');\nconst route = useRoute();\nimport request from '@/api/request.js';\nimport { useUserStore } from '@/stores/user.js';\nconst productList = ref([]);\nconst searchPerformed = ref(false);\nconst userStore = useUserStore();\nconst recentSearches = ref(userStore.getRecentSearches);\n\n// 额外筛选项\nconst priceMin = ref(0);\nconst priceMax = ref(100000);\nconst priceSort = ref(true); // true: 升序\nconst dateSort = ref(false); // false: 默认降序\n\nconst handleSearch = async () => {\n  if (!searchValue.value.trim()) return;\n  // 保存搜索内容到本地存储\n  uni.setStorageSync('searchValue', searchValue.value); // 存储搜索内容\n  // 添加搜索记录\n  userStore.addSearchRecord(searchValue.value);\n  recentSearches.value = userStore.getRecentSearches;\n  const payload = {\n    labelId: null,\n    commodityPriceMin: priceMin.value,\n    commodityPriceMax: priceMax.value,\n    commodityKeyWord: searchValue.value,\n    priceSort: priceSort.value,\n    dateSort: dateSort.value,\n    commodityStatus: 1,\n    pageDTO: {\n      pageSize: 10,\n      pageIndex: 1\n    }\n  };\n\n  try {\n    const res = await request({\n      url: \"/commodity/listCommodityByDTO\",\n      method: \"POST\",\n      data: payload\n    });\n\n    if (res.code === 200) {\n      productList.value = res.data || [];\n      searchPerformed.value = true;\n    } else {\n      uni.showToast({ title: '搜索失败', icon: 'none' });\n    }\n  } catch (err) {\n    console.error(\"搜索失败\", err);\n    uni.showToast({ title: '请求错误', icon: 'none' });\n  }\n};\n\n// 点击查看详情\nconst viewProductDetail = (id) => {\n  uni.navigateTo({\n    url: `/pages/productDetail/productDetail?commodityId=${id}`\n  });\n};\n\n// 标签点击触发搜索\nconst handleTagClick = (value) => {\n  searchValue.value = value;\n  handleSearch();\n};\n\nconst removeSearchItem = (index) => {\n  uni.showModal({\n    title: '提示',\n    content: '确定删除该搜索记录吗？',\n    success: (res) => {\n      if (res.confirm) {\n        userStore.removeSearchRecord(index);\n        recentSearches.value = userStore.getRecentSearches;\n      }\n    }\n  });\n};\n\nconst clearHistory = () => {\n  uni.showModal({\n    title: '提示',\n    content: '确定清空所有搜索记录吗？',\n    success: (res) => {\n      if (res.confirm) {\n        userStore.clearSearchHistory();\n        recentSearches.value = [];\n      }\n    }\n  });\n};\n\nconst input = (res) => searchValue.value = res.value;\nconst cancel = () => searchValue.value = '';\nconst blur = () => {};\nconst focus = () => {};\nconst clear = () => searchValue.value = '';\n\nonMounted(() => {\n  const storedSearchValue = uni.getStorageSync('searchValue');\n  if (storedSearchValue) {\n    searchValue.value = storedSearchValue; // 将存储的值赋给 searchValue\n  }\n});\n</script>\n\n\n<style scoped>\n.container {\n  padding: 20px;\n  background-color: #fff;\n}\n\n.filters {\n  margin-top: 20px;\n  margin-bottom: 20px;\n}\n.result-list {\n  margin-top: 20px;\n}\n\n.result-item {\n  display: flex;\n  padding: 10px;\n  border-bottom: 1px solid #eee;\n}\n\n.result-image {\n  width: 100px;\n  height: 100px;\n  border-radius: 8px;\n  background-color: #f1f1f1;\n  margin-right: 10px;\n}\n\n.result-info {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-around;\n}\n\n.result-title {\n  font-size: 16px;\n  font-weight: bold;\n  color: #333;\n}\n\n.result-desc {\n  font-size: 14px;\n  color: #666;\n  margin: 5px 0;\n}\n\n.result-price {\n  font-size: 16px;\n  color: #ff6b00;\n}\n\n.empty-tip {\n  text-align: center;\n  margin-top: 40px;\n  color: #999;\n  font-size: 14px;\n}\n\n.filter-group {\n  display: flex;\n  align-items: center;\n  margin-bottom: 15px;\n}\n\n.label {\n  width: 90px;\n  font-size: 14px;\n  color: #333;\n}\n\n.input {\n  width: 90px;\n  padding: 5px 10px;\n  margin-right: 8px;\n  border: 1px solid #ccc;\n  border-radius: 5px;\n}\n\n.to {\n  margin-right: 8px;\n}\n\n.search-tags {\n  display: flex;\n  flex-wrap: wrap;\n  margin-top: 10px;\n}\n\n.tag {\n  margin: 5px;\n  padding: 8px 15px;\n  background-color: #f1f1f1;\n  border-radius: 20px;\n  font-size: 14px;\n  color: #333;\n}\n\n.section {\n  margin-top: 20px;\n}\n\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 10px;\n}\n\n.section-title {\n  font-size: 16px;\n  color: #333;\n  font-weight: bold;\n}\n\n.clear-btn {\n  font-size: 14px;\n  color: #999;\n}\n</style>\n","import MiniProgramPage from 'D:/作业/软件工程/课程设计/campustrade/code/campustrade-front/pages/search/search.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}