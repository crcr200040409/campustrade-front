{"version":3,"file":"request.js","sources":["api/request.js"],"sourcesContent":["// 全局请求封装\nconst base_url = 'http://8.134.64.30:8080/second-trade'\n// 需要修改token，和根据实际修改请求头\nexport default (params) => {\n\tlet url = params.url;\n\tlet method = params.method || \"get\";\n\tlet data = params.data || {};\n\tlet header = {\n\t\t// 为了避免手动设置，统一请求头\n\t\t'Content-Type': 'application/json',\n\t};\n\n\t// 获取本地token\n\tconst token = uni.getStorageSync(\"token\");\n\tif (token) {\n\t\theader['Authorization'] = 'Bearer ' + token;\n\t}\n\n\treturn new Promise((resolve, reject) => {\n\t\tuni.request({\n\t\t\turl: base_url + url,\n\t\t\tmethod: method,\n\t\t\theader: header,\n\t\t\tdata: data,\n\t\t\tsuccess(response) {\n\t\t\t\tconst res = response;\n\t\t\t\tif (res.statusCode == 200) {\n\t\t\t\t\tresolve(res.data);\n\t\t\t\t} else {\n\t\t\t\t\tuni.clearStorageSync();\n\t\t\t\t\tswitch (res.statusCode) {\n\t\t\t\t\t\tcase 401:\n\t\t\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\t\t\ttitle: \"提示\",\n\t\t\t\t\t\t\t\tcontent: \"请登录\",\n\t\t\t\t\t\t\t\tshowCancel: false,\n\t\t\t\t\t\t\t\tsuccess(res) {\n\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\tuni.navigateTo({\n\t\t\t\t\t\t\t\t\t\t\turl: \"/pages/login/index\",\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 404:\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ttitle: '请求地址不存在...',\n\t\t\t\t\t\t\t\tduration: 2000,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ttitle: '请重试...',\n\t\t\t\t\t\t\t\tduration: 2000,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tfail(err) {\n\t\t\t\tconsole.log(err);\n\t\t\t\tif (err.errMsg.indexOf('request:fail') !== -1) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '网络异常',\n\t\t\t\t\t\ticon: \"error\",\n\t\t\t\t\t\tduration: 2000,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '未知异常',\n\t\t\t\t\t\tduration: 2000,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treject(err);\n\t\t\t},\n\t\t\tcomplete() {\n\t\t\t\tuni.hideLoading();\n\t\t\t\tuni.hideToast();\n\t\t\t}\n\t\t});\n\t}).catch((e) => {});\n};\n"],"names":["uni","res"],"mappings":";;AACA,MAAM,WAAW;AAEjB,MAAe,UAAA,CAAC,WAAW;AAC1B,MAAI,MAAM,OAAO;AACjB,MAAI,SAAS,OAAO,UAAU;AAC9B,MAAI,OAAO,OAAO,QAAQ;AAC1B,MAAI,SAAS;AAAA;AAAA,IAEZ,gBAAgB;AAAA,EAClB;AAGC,QAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,MAAI,OAAO;AACV,WAAO,eAAe,IAAI,YAAY;AAAA,EACtC;AAED,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvCA,kBAAAA,MAAI,QAAQ;AAAA,MACX,KAAK,WAAW;AAAA,MAChB;AAAA,MACA;AAAA,MACA;AAAA,MACA,QAAQ,UAAU;AACjB,cAAM,MAAM;AACZ,YAAI,IAAI,cAAc,KAAK;AAC1B,kBAAQ,IAAI,IAAI;AAAA,QACrB,OAAW;AACNA,wBAAG,MAAC,iBAAgB;AACpB,kBAAQ,IAAI,YAAU;AAAA,YACrB,KAAK;AACJA,4BAAAA,MAAI,UAAU;AAAA,gBACb,OAAO;AAAA,gBACP,SAAS;AAAA,gBACT,YAAY;AAAA,gBACZ,QAAQC,MAAK;AACZ,6BAAW,MAAM;AAChBD,kCAAAA,MAAI,WAAW;AAAA,sBACd,KAAK;AAAA,oBAChB,CAAW;AAAA,kBACD,GAAE,GAAI;AAAA,gBACP;AAAA,cACT,CAAQ;AACD;AAAA,YACD,KAAK;AACJA,4BAAAA,MAAI,UAAU;AAAA,gBACb,OAAO;AAAA,gBACP,UAAU;AAAA,cAClB,CAAQ;AACD;AAAA,YACD;AACCA,4BAAAA,MAAI,UAAU;AAAA,gBACb,OAAO;AAAA,gBACP,UAAU;AAAA,cAClB,CAAQ;AACD;AAAA,UACD;AAAA,QACD;AAAA,MACD;AAAA,MACD,KAAK,KAAK;AACTA,sBAAAA,MAAA,MAAA,OAAA,wBAAY,GAAG;AACf,YAAI,IAAI,OAAO,QAAQ,cAAc,MAAM,IAAI;AAC9CA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,YACN,UAAU;AAAA,UAChB,CAAM;AAAA,QACN,OAAW;AACNA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,UAAU;AAAA,UAChB,CAAM;AAAA,QACD;AACD,eAAO,GAAG;AAAA,MACV;AAAA,MACD,WAAW;AACVA,sBAAG,MAAC,YAAW;AACfA,sBAAG,MAAC,UAAS;AAAA,MACb;AAAA,IACJ,CAAG;AAAA,EACD,CAAA,EAAE,MAAM,CAAC,MAAM;AAAA,EAAE,CAAA;AACnB;;"}