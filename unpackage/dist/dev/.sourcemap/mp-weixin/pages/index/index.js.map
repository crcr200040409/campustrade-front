{"version":3,"file":"index.js","sources":["pages/index/index.vue","../../../../../../ProgramFiles/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\n  <view class=\"login-container\">\n    <image class=\"logo\" src=\"/static/logo.png\" alt=\"吉刻转 Logo\"></image>\n    <view class=\"text-area\">\n      <text class=\"title\">吉刻转</text>\n    </view>\n    <button class=\"wechat-login-button\" @click=\"wechatLogin\">使用微信登录</button>\n    <button class=\"guest-login-button\" @click=\"guestLogin\">游客登录</button>\n  </view>\n\n</template>\n\n<script setup>\nimport request from \"@/api/request.js\";\nconst wechatLogin = () => {\n  wx.login({\n    async success(res) {\n      if (res.code) {\n        console.log(\"code          \"+res.code);\n        //发起网络请求\n        wx.request({\n          url: 'https://example.com/onLogin',\n          data: {\n            code: res.code\n          }\n        })\n        const sessionId = await request({\n          url: `/user/sessionId/${res.code}`, // 把code拼接到路径中\n          method: \"GET\"\n        });\n        if(sessionId){\n          // 微信授权\n          \n          wx.getUserInfo({\n            success: async function (res) {\n              const encryptedData=res.encryptedData\n              const iv=res.iv\n              const loginRes = await request({\n                url: \"/user/login\",\n                method: \"POST\",\n                data: {\n                  encryptedData,\n                  iv,\n                  sessionId\n                }\n              });\n              if(loginRes.code==200) {\n                uni.showToast({\n                  title: '登录成功',\n                  icon: 'success'\n                });\n                const userData = loginRes.data;\n                //console.log(userData)\n                uni.setStorageSync('userInfo', userData);\n                uni.switchTab({\n                  url: \"/pages/home/home\"\n                });\n                console.log(loginRes);\n              }else{\n                uni.showToast({\n                  title: '登录失败',\n                  icon: 'error'\n                });\n              }\n            }\n          })\n        }\n      } else {\n        console.log('登录失败！' + res.errMsg)\n      }\n    }\n  })\n};\n\nconst guestLogin=()=> {\n  // 游客登录逻辑\n  console.log('游客登录成功');\n  uni.showToast({\n    title: '游客登录成功',\n    icon: 'success',\n  });\n  // 使用 switchTab 跳转到首页\n  uni.switchTab({\n    url: '/pages/home/home'\n  });\n}\n</script>\n\n<style scoped>\n.login-container {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  padding: 20px;\n}\n\n.logo {\n  width: 200rpx;\n  height: 200rpx;\n  margin-bottom: 40rpx;\n}\n\n.text-area {\n  margin-bottom: 30rpx;\n}\n\n.title {\n  font-size: 36rpx;\n  color: #8f8f94;\n}\n\n.wechat-login-button,\n.guest-login-button {\n  width: 100%;\n  padding: 14rpx;\n  border-radius: 6rpx;\n  font-size: 16px;\n  margin-top: 20rpx;\n}\n\n.wechat-login-button {\n  background-color: #1d9bf0;\n  color: white;\n}\n\n.guest-login-button {\n  background-color: #f0f0f0;\n  color: #1d9bf0;\n  border: 1px solid #1d9bf0;\n}\n</style>\n","import MiniProgramPage from 'D:/作业/软件工程/课程设计/campustrade/code/campustrade-front/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["wx","uni","request","res"],"mappings":";;;;;;;AAcA,UAAM,cAAc,MAAM;AACxBA,oBAAAA,KAAG,MAAM;AAAA,QACP,MAAM,QAAQ,KAAK;AACjB,cAAI,IAAI,MAAM;AACZC,0BAAY,MAAA,MAAA,OAAA,+BAAA,mBAAiB,IAAI,IAAI;AAErCD,0BAAAA,KAAG,QAAQ;AAAA,cACT,KAAK;AAAA,cACL,MAAM;AAAA,gBACJ,MAAM,IAAI;AAAA,cACX;AAAA,YACX,CAAS;AACD,kBAAM,YAAY,MAAME,oBAAQ;AAAA,cAC9B,KAAK,mBAAmB,IAAI,IAAI;AAAA;AAAA,cAChC,QAAQ;AAAA,YAClB,CAAS;AACD,gBAAG,WAAU;AAGXF,4BAAAA,KAAG,YAAY;AAAA,gBACb,SAAS,eAAgBG,MAAK;AAC5B,wBAAM,gBAAcA,KAAI;AACxB,wBAAM,KAAGA,KAAI;AACb,wBAAM,WAAW,MAAMD,oBAAQ;AAAA,oBAC7B,KAAK;AAAA,oBACL,QAAQ;AAAA,oBACR,MAAM;AAAA,sBACJ;AAAA,sBACA;AAAA,sBACA;AAAA,oBACD;AAAA,kBACjB,CAAe;AACD,sBAAG,SAAS,QAAM,KAAK;AACrBD,kCAAAA,MAAI,UAAU;AAAA,sBACZ,OAAO;AAAA,sBACP,MAAM;AAAA,oBACxB,CAAiB;AACD,0BAAM,WAAW,SAAS;AAE1BA,kCAAAA,MAAI,eAAe,YAAY,QAAQ;AACvCA,kCAAAA,MAAI,UAAU;AAAA,sBACZ,KAAK;AAAA,oBACvB,CAAiB;AACDA,kCAAAA,MAAY,MAAA,OAAA,+BAAA,QAAQ;AAAA,kBACpC,OAAmB;AACHA,kCAAAA,MAAI,UAAU;AAAA,sBACZ,OAAO;AAAA,sBACP,MAAM;AAAA,oBACxB,CAAiB;AAAA,kBACF;AAAA,gBACF;AAAA,cACb,CAAW;AAAA,YACF;AAAA,UACT,OAAa;AACLA,0BAAA,MAAA,MAAA,OAAA,+BAAY,UAAU,IAAI,MAAM;AAAA,UACjC;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAEA,UAAM,aAAW,MAAK;AAEpBA,oBAAAA,MAAY,MAAA,OAAA,+BAAA,QAAQ;AACpBA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,MAAM;AAAA,MACV,CAAG;AAEDA,oBAAAA,MAAI,UAAU;AAAA,QACZ,KAAK;AAAA,MACT,CAAG;AAAA,IACH;;;;;;;;;;;ACpFA,GAAG,WAAW,eAAe;"}