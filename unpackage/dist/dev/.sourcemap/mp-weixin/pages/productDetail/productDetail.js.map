{"version":3,"file":"productDetail.js","sources":["pages/productDetail/productDetail.vue","../../../../../../ProgramFiles/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvZHVjdERldGFpbC9wcm9kdWN0RGV0YWlsLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 商品图片轮播 -->\n    <swiper class=\"product-swiper\" indicator-dots autoplay circular>\n      <swiper-item>\n        <image :src=\"product.commodityPhoto || '/images/default.jpg'\" mode=\"aspectFill\" class=\"swiper-image\" />\n      </swiper-item>\n      <!-- 可以添加更多图片 -->\n    </swiper>\n\n    <!-- 商品基本信息 -->\n    <view class=\"product-info\">\n      <view class=\"price-section\">\n        <text class=\"price-symbol\">¥</text>\n        <text class=\"product-price\">{{ product.commodityPrice.toFixed(2) }}</text>\n      </view>\n      <text class=\"product-title\">{{ product.commodityName }}</text>\n      <view class=\"meta-info\">\n        <text class=\"publish-time\">发布时间: {{ formatTime(product.commodityPublishTime) }}</text>\n        <text class=\"modify-time\" v-if=\"product.commodityModifyTime\">更新: {{ formatTime(product.commodityModifyTime) }}</text>\n      </view>\n    </view>\n\n    <!-- 商品描述 -->\n    <view class=\"description-card\">\n      <text class=\"section-title\">商品描述</text>\n      <text class=\"product-description\">{{ product.commodityDescription }}</text>\n    </view>\n\n    <!-- 卖家信息 -->\n    <view class=\"seller-card\">\n      <text class=\"section-title\">卖家信息</text>\n      <view class=\"seller-info\">\n        <image src=\"/static/images/avatar.png\" class=\"seller-avatar\" />\n        <text class=\"seller-name\">用户{{ product.openId.slice(-4) }}</text>\n      </view>\n    </view>\n\n    <!-- 底部操作栏 -->\n    <view class=\"action-bar\">\n      <button class=\"action-btn collect-btn\" @tap=\"toggleCollect\">\n        <uni-icons :type=\"isCollected ? 'heart-filled' : 'heart'\" size=\"24\" color=\"#333\" class=\"btn-icon\"></uni-icons>\n        <text>{{ isCollected ? '已收藏' : '收藏' }}</text>\n      </button>\n\n      <button class=\"action-btn contact-btn\" @tap=\"contactSeller\">\n        <image src=\"/static/images/contact.png\" class=\"btn-icon\" />\n        <text>联系卖家</text>\n      </button>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport {ref, onMounted} from 'vue';\nimport request from \"@/api/request.js\";\nconst userInfo = ref(uni.getStorageSync('userInfo') || null);\n\nconst product = ref({\n  commodityId:0,\n  commodityPrice: 0,\n  commodityPhoto: '',\n  commodityName: '',\n  commodityDescription: '',\n  commodityPublishTime: '',\n  openId: ''\n});\nconst isCollected = ref(false);\n// 格式化时间显示\nconst formatTime = (timeString) => {\n  if (!timeString) return '';\n  const date = new Date(timeString);\n  return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;\n};\n// 获取商品详情\nconst fetchProductDetail = async (commodityId) => {\n  try {\n    const response = await request({\n      url: \"/commodity/getCommodityDetail\",\n      method: \"POST\",\n      data: commodityId\n    });\n    if (response.code === 200 && response.data) {\n      product.value = response.data;\n      // 检查是否已收藏\n      await checkCollectionStatus(commodityId);\n    } else {\n      uni.showToast({\n        title: '获取商品详情失败',\n        icon: 'none'\n      });\n    }\n  } catch (error) {\n    console.error(\"请求商品详情失败\", error);\n    uni.showToast({\n      title: '请求失败',\n      icon: 'none'\n    });\n  }\n};\n\nconst checkCollectionStatus = async (commodityId) => {\n  try {\n    const res = await request({\n      url: `/user/listCollectionCommodity?openId=${userInfo.value.openId}`,\n      method: 'POST'\n    });\n    console.log(\"resInfo----------->\", JSON.stringify(res, null, 2));\n    if (res.code === 200 && Array.isArray(res.data)) {\n      isCollected.value = res.data.find(item => item.commodityId === Number(commodityId)) !== undefined;\n\n    } else {\n      isCollected.value = false;\n    }\n  } catch (error) {\n    console.error(\"检查收藏状态失败\", error);\n  }\n};\n\n// 切换收藏状态\nconst toggleCollect = async () => {\n  isCollected.value = !isCollected.value;\n  const url = isCollected.value ? '/user/collectCommodity' : '/user/removeCommodity'; // 根据收藏状态切换URL\n  try {\n    const res = await request({\n      url: url, // API接口\n      method: 'POST',\n      data: {\n        openId: userInfo.value.openId, // 用户ID\n        commodityId: [product.value.commodityId], // 商品ID数组\n      }\n    });\n    if (res.code === 200) {\n      uni.showToast({\n        title: isCollected.value ? '已收藏' : '已取消收藏',\n        icon: 'none'\n      });\n    } else {\n      uni.showToast({\n        title: '操作失败，请稍后再试',\n        icon: 'none'\n      });\n    }\n  } catch (error) {\n    console.error('操作失败', error);\n    uni.showToast({\n      title: '请求失败',\n      icon: 'none'\n    });\n  }\n};\n\n// 联系卖家\nconst contactSeller = () => {\n  uni.showToast({\n    title: '正在联系卖家...',\n    icon: 'none'\n  });\n  // 联系卖家\n  uni.navigateTo({\n    url: `/pages/chatdetail/chatdetail?sellerId=${product.value.openId}`\n  });\n\n  // 这里可以实现跳转到聊天页面或复制联系方式\n};\n\n// 页面加载时获取商品详情\nonMounted(() => {\n  const pages = getCurrentPages();\n  const currentPage = pages[pages.length - 1];\n  const commodityId = currentPage.options.commodityId;\n  fetchProductDetail(commodityId);\n  checkCollectionStatus(commodityId)\n});\n</script>\n\n<style scoped>\n.container {\n  padding-bottom: 100px;\n  background-color: #f7f7f7;\n  min-height: 100vh;\n}\n\n/* 商品轮播图样式 */\n.product-swiper {\n  width: 100%;\n  height: 375px;\n  background-color: #f5f5f5;\n}\n\n.swiper-image {\n  width: 100%;\n  height: 100%;\n}\n\n/* 商品信息区域 */\n.product-info {\n  padding: 20px 15px;\n  background-color: #fff;\n  margin-bottom: 10px;\n}\n\n.price-section {\n  display: flex;\n  align-items: baseline;\n  margin-bottom: 10px;\n}\n\n.price-symbol {\n  font-size: 18px;\n  color: #ff6b00;\n  font-weight: bold;\n}\n\n.product-price {\n  font-size: 24px;\n  color: #ff6b00;\n  font-weight: bold;\n  margin-left: 2px;\n}\n\n.product-title {\n  font-size: 18px;\n  font-weight: bold;\n  margin-bottom: 10px;\n  line-height: 1.4;\n}\n\n.meta-info {\n  display: flex;\n  justify-content: space-between;\n  font-size: 12px;\n  color: #999;\n}\n\n/* 描述卡片 */\n.description-card {\n  background-color: #fff;\n  padding: 15px;\n  margin-bottom: 10px;\n  border-radius: 0;\n}\n\n.section-title {\n  font-size: 16px;\n  font-weight: bold;\n  margin-bottom: 10px;\n  display: block;\n  color: #333;\n}\n\n.product-description {\n  font-size: 14px;\n  color: #666;\n  line-height: 1.6;\n}\n\n/* 卖家信息卡片 */\n.seller-card {\n  background-color: #fff;\n  padding: 15px;\n  margin-bottom: 10px;\n}\n\n.seller-info {\n  display: flex;\n  align-items: center;\n  padding: 10px 0;\n}\n\n.seller-avatar {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  margin-right: 10px;\n}\n\n.seller-name {\n  font-size: 15px;\n  color: #333;\n}\n\n/* 底部操作栏 */\n.action-bar {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  height: 60px;\n  background-color: #fff;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 15px;\n  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);\n  z-index: 100;\n}\n\n.action-btn {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  background: none;\n  border: none;\n  font-size: 12px;\n  color: #666;\n  padding: 5px 15px;\n  height: 100%;\n}\n\n.action-btn::after {\n  border: none;\n}\n\n.btn-icon {\n  width: 24px;\n  height: 28px;\n  margin-bottom: 3px;\n}\n\n.collect-btn {\n  color: #666;\n}\n\n\n.contact-btn {\n  flex: 1;\n  background-color: #ff6b00;\n  color: #fff;\n  border-radius: 30px;\n  margin-left: 15px;\n  height: 45px;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: center;\n}\n\n.contact-btn text {\n  color: #fff;\n  font-size: 16px;\n  margin-left: 5px;\n}\n</style>","import MiniProgramPage from 'D:/作业/软件工程/课程设计/campustrade/code/campustrade-front/pages/productDetail/productDetail.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","request","onMounted"],"mappings":"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"}