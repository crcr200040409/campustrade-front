{"version":3,"file":"sell.js","sources":["pages/sell/sell.vue","../../../../../../ProgramFiles/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VsbC9zZWxsLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部导航栏 -->\n    <view class=\"header\">\n      <text class=\"header-title\">发布闲置</text>\n    </view>\n\n    <!-- 商品表单区域 -->\n    <scroll-view class=\"form-container\" scroll-y>\n      <!-- 商品图片上传 -->\n      <view class=\"upload-section\">\n        <text class=\"section-title\">上传商品图片(最多1张)</text>\n        <view class=\"image-grid\">\n          <view class=\"image-item\" v-for=\"(img, index) in images\" :key=\"index\">\n            <image :src=\"img\" mode=\"aspectFill\" class=\"preview-image\"></image>\n            <view class=\"delete-btn\" @click=\"removeImage(index)\">×</view>\n          </view>\n          <view class=\"image-item add-btn\" @click=\"chooseImage\" v-if=\"images.length < 1\">\n            <view class=\"add-icon\">+</view>\n          </view>\n        </view>\n      </view>\n\n      <!-- 商品信息 -->\n      <view class=\"form-section\">\n        <text class=\"section-title\">商品信息</text>\n        <view class=\"form-item\">\n          <text class=\"item-label\">商品名称</text>\n          <input class=\"item-input\" placeholder=\"请输入商品名称\" v-model=\"form.title\" />\n        </view>\n        <view class=\"form-item\">\n          <text class=\"item-label\">商品描述</text>\n          <textarea class=\"item-textarea\" placeholder=\"请详细描述商品情况\" v-model=\"form.description\"></textarea>\n        </view>\n\n\n        <view class=\"form-item\">\n          <text class=\"item-label\">商品分类</text>\n          <view class=\"radio-group\">\n            <label v-for=\"(category, index) in categories\" :key=\"index\" class=\"radio-item\">\n              <radio\n                  :value=\"category.id\"\n                  :checked=\"form.categoryId === category.id\"\n                  @click=\"handleCategoryChange(category.id)\"\n              />\n              {{ category.name }}\n            </label>\n          </view>\n        </view>\n\n        <view class=\"form-item\">\n          <text class=\"item-label\">商品价格</text>\n          <input class=\"item-input\" type=\"number\" placeholder=\"请输入价格，保留两位小数\" v-model=\"form.Price\" />\n        </view>\n      </view>\n    </scroll-view>\n\n    <!-- 底部发布按钮 -->\n    <view class=\"footer\">\n      <button class=\"publish-btn\" @click=\"submitForm\">\n        <text class=\"btn-text\">发布闲置</text>\n      </button>\n    </view>\n  </view>\n</template>\n\n\n<script setup>\nimport { ref } from 'vue'\nimport request from '@/api/request.js';\n// 表单数据\nconst form = ref({\n  title: '',\n  description: '',\n  categoryId: 1,\n  Price: ''\n})\nconst handleCategoryChange = (categoryId) => {\n  console.log(\"选中了分类ID:\", categoryId);\n  form.value.categoryId = categoryId;\n  console.log(\"当前form.categoryId:\", form.value.categoryId);\n};\nconst images = ref([]) // 商品图片\nconst categories = ref([\n  { id: 1, name: '数码电子', description: '电子产品' },\n  { id: 2, name: '图书教材', description: '书籍' },\n  { id: 3, name: '家居生活', description: '家居用品' },\n  { id: 4, name: '运动户外', description: '运动器材' }\n])\n// 选择图片\nconst chooseImage = () => {\n  uni.chooseImage({\n    count: 1,  // 只选择一张图片\n    sizeType: ['compressed'],\n    sourceType: ['album', 'camera'],\n    success: (res) => {\n      // 获取选择的图片\n      images.value = [res.tempFilePaths[0]]; // 只保留最新选择的图片\n    }\n  });\n}\n\n// 删除图片\nconst removeImage = (index) => {\n  images.value.splice(index, 1)\n}\n\n\nconst submitForm = async () => {\n  // console.log(\"updatedUserInfo----------->\", JSON.stringify(form, 2));\n  if (!form.value.title) {\n    uni.showToast({ title: '请填写商品名称', icon: 'none' });\n    return;\n  }\n  if (images.value.length === 0) {\n    uni.showToast({ title: '请上传商品图片', icon: 'none' });\n    return;\n  }\n  if (!form.value.Price) {\n    uni.showToast({ title: '请输入商品价格', icon: 'none' });\n    return;\n  }\n  if (!form.value.categoryId) {\n    uni.showToast({ title: '请选择商品分类', icon: 'none' });\n    return;\n  }\n\n  // 从缓存中获取 openId\n  const openId = uni.getStorageSync('userInfo')?.openId;\n  if (!openId) {\n    uni.showToast({ title: '未找到用户信息，请先登录', icon: 'none' });\n    return;\n  }\n\n  // 准备提交的数据\n  const commodityData = {\n    commodityName: form.value.title,\n    commodityPhoto: images.value[0],  // 使用上传的第一张图片\n    commodityDescription: form.value.description,\n    labelId: form.value.categoryId,  // 使用单一的分类ID\n    commodityPrice: parseFloat(form.value.Price),\n    openId: openId\n  };\n\n  // 调用接口提交数据\n  try {\n    const res = await request({\n      url: '/commodity/addCommodity',\n      method: 'POST',\n      data: commodityData\n    });\n    if (res.code === 200) {\n      uni.showToast({\n        title: '发布成功',\n        icon: 'success'\n      });\n\n    } else {\n      uni.showToast({\n        title: '发布失败',\n        icon: 'none'\n      });\n    }\n  } catch (error) {\n    console.error('发布商品失败', error);\n    uni.showToast({\n      title: '发布失败',\n      icon: 'none'\n    });\n  }\n};\n\n</script>\n\n<style>\n/* 基础样式 */\npage {\n  background-color: #f5f5f5;\n}\n\n.container {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  background-color: #f5f5f5;\n}\n\n/* 头部样式优化 */\n.header {\n  padding: 15px;\n  background-color: #ffffff;\n  border-bottom: 1px solid #eee;\n  text-align: center;\n  position: sticky;\n  top: 0;\n  z-index: 10;\n}\n\n.header-title {\n  font-size: 18px;\n  font-weight: bold;\n  color: #333;\n}\n\n/* 表单容器优化 */\n.form-container {\n  flex: 1;\n  padding: 15px;\n  background-color: #fff;\n  box-sizing: border-box;\n}\n\n/* 各部分标题样式优化 */\n.section-title {\n  display: block;\n  font-size: 16px;\n  font-weight: bold;\n  margin: 15px 0 10px;\n  color: #333;\n  padding-left: 5px;\n  border-left: 3px solid #f9b826;\n}\n\n/* 图片上传区域优化 */\n.upload-section {\n  margin-bottom: 25px;\n  padding: 15px;\n  background-color: #fff;\n  border-radius: 12px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n}\n\n.image-grid {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 12px;\n}\n\n.image-item {\n  width: calc((100% - 24px) / 3);\n  height: 0;\n  padding-bottom: calc((100% - 24px) / 3);\n  position: relative;\n  border-radius: 8px;\n  overflow: hidden;\n  background-color: #f9f9f9;\n  border: 1px dashed #ddd;\n}\n\n.add-btn {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  background-color: #fafafa;\n  width: 100%;\n  height: 100%;\n}\n\n\n.add-icon {\n  font-size: 32px;\n  color: #ccc;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.preview-image {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  object-fit: cover;\n}\n\n.delete-btn {\n  position: absolute;\n  top: 5px;\n  right: 5px;\n  width: 20px;\n  height: 20px;\n  background-color: rgba(0, 0, 0, 0.5);\n  color: white;\n  border-radius: 50%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 14px;\n}\n\n/* 表单项目样式优化 */\n.form-section {\n  margin-bottom: 15px;\n  padding: 15px;\n  background-color: #fff;\n  border-radius: 12px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n}\n\n.form-item {\n  margin-bottom: 20px;\n}\n\n.item-label {\n  display: block;\n  margin-bottom: 8px;\n  font-size: 15px;\n  color: #333;\n  font-weight: 500;\n}\n\n.item-input, .item-textarea, .picker-view {\n  width: 100%;\n  padding: 12px 15px;\n  height: auto;\n  border: 1px solid #eaeaea;\n  border-radius: 8px;\n  background-color: #f9f9f9;\n  font-size: 15px;\n  box-sizing: border-box;\n}\n\n.item-input:focus, .item-textarea:focus {\n  border-color: #f9b826;\n}\n\n.item-textarea {\n  height: 120px;\n}\n\n.picker-view {\n  color: #999;\n}\n\n/* 底部按钮优化 */\n.footer {\n  padding: 15px;\n  background-color: #fff;\n  border-top: 1px solid #eee;\n  box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);\n}\n\n.publish-btn {\n  background-color: #f9b826;\n  color: white;\n  border-radius: 25px;\n  padding: 14px;\n  font-size: 16px;\n  border: none;\n  width: 100%;\n  box-shadow: 0 4px 12px rgba(249, 184, 38, 0.3);\n}\n\n.publish-btn::after {\n  border: none;\n}\n\n.btn-text {\n  font-weight: bold;\n}\n</style>","import MiniProgramPage from 'D:/作业/软件工程/课程设计/campustrade/code/campustrade-front/pages/sell/sell.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","request","MiniProgramPage"],"mappings":"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"}