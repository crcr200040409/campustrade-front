{"version":3,"file":"search.js","sources":["pages/search/search.vue","../../../../../../ProgramFiles/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VhcmNoL3NlYXJjaC52dWU"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 搜索框 -->\n    <uni-search-bar\n        @confirm=\"handleSearch\"\n        :focus=\"true\"\n        v-model=\"searchValue\"\n        @blur=\"blur\"\n        @focus=\"focus\"\n        @input=\"input\"\n        @cancel=\"cancel\"\n        @clear=\"clear\"\n    ></uni-search-bar>\n\n    <!-- 筛选项 -->\n    <view class=\"filters\">\n      <view class=\"filter-group\">\n        <text class=\"label\">价格区间：</text>\n        <input class=\"input\" type=\"number\" v-model.number=\"priceMin\" placeholder=\"最小价格\" />\n        <text class=\"to\">-</text>\n        <input class=\"input\" type=\"number\" v-model.number=\"priceMax\" placeholder=\"最大价格\" />\n      </view>\n      <view class=\"filter-group\">\n        <text class=\"label\">价格排序：</text>\n        <switch @change=\"e => priceSort = e.detail.value\" :checked=\"priceSort\" />\n        <text>{{ priceSort ? '升序' : '降序' }}</text>\n      </view>\n      <view class=\"filter-group\">\n        <text class=\"label\">时间排序：</text>\n        <switch @change=\"e => dateSort = e.detail.value\" :checked=\"dateSort\" />\n        <text>{{ dateSort ? '升序' : '降序' }}</text>\n      </view>\n    </view>\n\n    <!-- 最近搜索 -->\n    <view class=\"section\" v-if=\"recentSearches.length > 0\">\n      <view class=\"section-header\">\n        <text class=\"section-title\">最近搜索</text>\n        <text class=\"clear-btn\" @click=\"clearHistory\">清空</text>\n      </view>\n      <view class=\"search-tags\">\n        <view\n            class=\"tag\"\n            v-for=\"(item, index) in recentSearches\"\n            :key=\"index\"\n            @click=\"handleTagClick(item)\"\n            @longpress=\"removeSearchItem(index)\"\n        >\n          {{ item }}\n        </view>\n      </view>\n    </view>\n    <!-- 搜索结果展示 -->\n    <view class=\"result-list\" v-if=\"productList.length\">\n      <view\n          class=\"result-item\"\n          v-for=\"(item, index) in productList\"\n          :key=\"item.commodityId\"\n          @click=\"viewProductDetail(item.commodityId)\"\n      >\n        <image\n            :src=\"item.commodityPhoto || '/images/default.jpg'\"\n            class=\"result-image\"\n            mode=\"aspectFill\"\n        />\n        <view class=\"result-info\">\n          <text class=\"result-title\">{{ item.commodityName }}</text>\n          <text class=\"result-desc\">{{ item.commodityDescription }}</text>\n          <text class=\"result-price\">¥{{ item.commodityPrice.toFixed(2) }}</text>\n        </view>\n      </view>\n    </view>\n\n    <view v-else-if=\"searchPerformed\" class=\"empty-tip\">\n      暂无匹配商品结果\n    </view>\n  </view>\n\n</template>\n\n\n<script setup>\nimport { onMounted, ref } from 'vue';\nconst searchValue = ref('');\nimport request from '@/api/request.js';\nimport { useUserStore } from '@/stores/user.js';\nconst productList = ref([]);\nconst searchPerformed = ref(false);\nconst userStore = useUserStore();\nconst recentSearches = ref(userStore.getRecentSearches);\n\n// 额外筛选项\nconst priceMin = ref(0);\nconst priceMax = ref(100000);\nconst priceSort = ref(true); // true: 升序\nconst dateSort = ref(false); // false: 默认降序\n\nconst handleSearch = async () => {\n  if (!searchValue.value.trim()) return;\n  // 保存搜索内容到本地存储\n  uni.setStorageSync('searchValue', searchValue.value); // 存储搜索内容\n  // 添加搜索记录\n  userStore.addSearchRecord(searchValue.value);\n  recentSearches.value = userStore.getRecentSearches;\n  const payload = {\n    labelId: null,\n    commodityPriceMin: priceMin.value,\n    commodityPriceMax: priceMax.value,\n    commodityKeyWord: searchValue.value,\n    priceSort: priceSort.value,\n    dateSort: dateSort.value,\n    commodityStatus: 1,\n    pageDTO: {\n      pageSize: 10,\n      pageIndex: 1\n    }\n  };\n\n  try {\n    const res = await request({\n      url: \"/commodity/listCommodityByDTO\",\n      method: \"POST\",\n      data: payload\n    });\n\n    if (res.code === 200) {\n      productList.value = res.data || [];\n      searchPerformed.value = true;\n    } else {\n      uni.showToast({ title: '搜索失败', icon: 'none' });\n    }\n  } catch (err) {\n    console.error(\"搜索失败\", err);\n    uni.showToast({ title: '请求错误', icon: 'none' });\n  }\n};\n\n// 点击查看详情\nconst viewProductDetail = (id) => {\n  uni.navigateTo({\n    url: `/pages/productDetail/productDetail?commodityId=${id}`\n  });\n};\n\n// 标签点击触发搜索\nconst handleTagClick = (value) => {\n  searchValue.value = value;\n  handleSearch();\n};\n\nconst removeSearchItem = (index) => {\n  uni.showModal({\n    title: '提示',\n    content: '确定删除该搜索记录吗？',\n    success: (res) => {\n      if (res.confirm) {\n        userStore.removeSearchRecord(index);\n        recentSearches.value = userStore.getRecentSearches;\n      }\n    }\n  });\n};\n\nconst clearHistory = () => {\n  uni.showModal({\n    title: '提示',\n    content: '确定清空所有搜索记录吗？',\n    success: (res) => {\n      if (res.confirm) {\n        userStore.clearSearchHistory();\n        recentSearches.value = [];\n      }\n    }\n  });\n};\n\nconst input = (res) => searchValue.value = res.value;\nconst cancel = () => searchValue.value = '';\nconst blur = () => {};\nconst focus = () => {};\nconst clear = () => searchValue.value = '';\n\nonMounted(() => {\n  const storedSearchValue = uni.getStorageSync('searchValue');\n  if (storedSearchValue) {\n    searchValue.value = storedSearchValue; // 将存储的值赋给 searchValue\n  }\n});\n</script>\n\n\n<style scoped>\n.container {\n  padding: 20px;\n  background-color: #fff;\n}\n\n.filters {\n  margin-top: 20px;\n  margin-bottom: 20px;\n}\n.result-list {\n  margin-top: 20px;\n}\n\n.result-item {\n  display: flex;\n  padding: 10px;\n  border-bottom: 1px solid #eee;\n}\n\n.result-image {\n  width: 100px;\n  height: 100px;\n  border-radius: 8px;\n  background-color: #f1f1f1;\n  margin-right: 10px;\n}\n\n.result-info {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-around;\n}\n\n.result-title {\n  font-size: 16px;\n  font-weight: bold;\n  color: #333;\n}\n\n.result-desc {\n  font-size: 14px;\n  color: #666;\n  margin: 5px 0;\n}\n\n.result-price {\n  font-size: 16px;\n  color: #ff6b00;\n}\n\n.empty-tip {\n  text-align: center;\n  margin-top: 40px;\n  color: #999;\n  font-size: 14px;\n}\n\n.filter-group {\n  display: flex;\n  align-items: center;\n  margin-bottom: 15px;\n}\n\n.label {\n  width: 90px;\n  font-size: 14px;\n  color: #333;\n}\n\n.input {\n  width: 90px;\n  padding: 5px 10px;\n  margin-right: 8px;\n  border: 1px solid #ccc;\n  border-radius: 5px;\n}\n\n.to {\n  margin-right: 8px;\n}\n\n.search-tags {\n  display: flex;\n  flex-wrap: wrap;\n  margin-top: 10px;\n}\n\n.tag {\n  margin: 5px;\n  padding: 8px 15px;\n  background-color: #f1f1f1;\n  border-radius: 20px;\n  font-size: 14px;\n  color: #333;\n}\n\n.section {\n  margin-top: 20px;\n}\n\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 10px;\n}\n\n.section-title {\n  font-size: 16px;\n  color: #333;\n  font-weight: bold;\n}\n\n.clear-btn {\n  font-size: 14px;\n  color: #999;\n}\n</style>\n","import MiniProgramPage from 'D:/作业/软件工程/课程设计/campustrade/code/campustrade-front/pages/search/search.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","useUserStore","uni","request","onMounted"],"mappings":"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"}