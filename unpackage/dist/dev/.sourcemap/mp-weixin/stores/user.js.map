{"version":3,"file":"user.js","sources":["stores/user.js"],"sourcesContent":["import { defineStore } from 'pinia';\r\nimport { ref } from 'vue';\r\nexport const useUserStore = defineStore('user', {\r\n    state: () => ({\r\n        // 用户基本信息\r\n        open_id: '',\r\n        user_type: 0, // 0:普通用户, 1:管理员\r\n        phone_number: '',\r\n        user_gender: 2, // 0:男, 1:女, 2:未知\r\n        user_name: '',\r\n        avatar: '',\r\n        // 最近搜索记录列表\r\n        recentSearches: [],\r\n        // 最大搜索记录保存数量\r\n        maxSearchHistory: 10\r\n    }),\r\n    actions: {\r\n        // 更新用户基本信息\r\n        updateUserInfo(userInfo) {\r\n            this.open_id = userInfo.open_id || this.open_id;\r\n            this.user_type = userInfo.user_type !== undefined ? userInfo.user_type : this.user_type;\r\n            this.phone_number = userInfo.phone_number || this.phone_number;\r\n            this.user_gender = userInfo.user_gender !== undefined ? userInfo.user_gender : this.user_gender;\r\n            this.user_name = userInfo.user_name || this.user_name;\r\n            this.avatar = userInfo.avatar || this.avatar;\r\n        },\r\n        // 清除用户信息\r\n        clearUserInfo() {\r\n            this.open_id = '';\r\n            this.user_type = 0;\r\n            this.phone_number = '';\r\n            this.user_gender = 2;\r\n            this.user_name = '';\r\n            this.avatar = '';\r\n            this.recentSearches = [];\r\n        },\r\n        // 添加搜索记录\r\n        addSearchRecord(searchTerm) {\r\n            if (!searchTerm.trim()) return;\r\n            // 移除重复的搜索项\r\n            this.recentSearches = this.recentSearches.filter(\r\n                item => item.toLowerCase() !== searchTerm.toLowerCase()\r\n            );\r\n            // 添加到数组开头\r\n            this.recentSearches.unshift(searchTerm);\r\n            // 限制最大数量\r\n            if (this.recentSearches.length > this.maxSearchHistory) {\r\n                this.recentSearches = this.recentSearches.slice(0, this.maxSearchHistory);\r\n            }\r\n        },\r\n        // 移除单个搜索记录\r\n        removeSearchRecord(index) {\r\n            if (index >= 0 && index < this.recentSearches.length) {\r\n                this.recentSearches.splice(index, 1);\r\n            }\r\n        },\r\n        // 清空搜索记录\r\n        clearSearchHistory() {\r\n            this.recentSearches = [];\r\n        },\r\n        // 检查是否是管理员\r\n        isAdmin() {\r\n            return this.user_type === 1;\r\n        }\r\n    },\r\n    getters: {\r\n        // 获取用户基本信息\r\n        userInfo: (state) => ({\r\n            open_id: state.open_id,\r\n            user_type: state.user_type,\r\n            phone_number: state.phone_number,\r\n            user_gender: state.user_gender,\r\n            user_name: state.user_name,\r\n            avatar: state.avatar\r\n        }),\r\n        // 获取格式化性别\r\n        genderText: (state) => {\r\n            const genderMap = ['男', '女', '未知'];\r\n            return genderMap[state.user_gender] || '未知';\r\n        },\r\n        // 获取最近的搜索记录\r\n        getRecentSearches: (state) => state.recentSearches\r\n    },\r\n    // 持久化配置\r\n    persist: {\r\n        enabled: true,\r\n        strategies: [\r\n            {\r\n                key: 'user',\r\n                storage: localStorage,\r\n                paths: ['open_id', 'user_type', 'phone_number', 'user_gender', 'user_name', 'avatar', 'recentSearches']\r\n            }\r\n        ]\r\n    }\r\n});"],"names":["defineStore"],"mappings":";;AAEY,MAAC,eAAeA,cAAW,YAAC,QAAQ;AAAA,EAC5C,OAAO,OAAO;AAAA;AAAA,IAEV,SAAS;AAAA,IACT,WAAW;AAAA;AAAA,IACX,cAAc;AAAA,IACd,aAAa;AAAA;AAAA,IACb,WAAW;AAAA,IACX,QAAQ;AAAA;AAAA,IAER,gBAAgB,CAAE;AAAA;AAAA,IAElB,kBAAkB;AAAA,EAC1B;AAAA,EACI,SAAS;AAAA;AAAA,IAEL,eAAe,UAAU;AACrB,WAAK,UAAU,SAAS,WAAW,KAAK;AACxC,WAAK,YAAY,SAAS,cAAc,SAAY,SAAS,YAAY,KAAK;AAC9E,WAAK,eAAe,SAAS,gBAAgB,KAAK;AAClD,WAAK,cAAc,SAAS,gBAAgB,SAAY,SAAS,cAAc,KAAK;AACpF,WAAK,YAAY,SAAS,aAAa,KAAK;AAC5C,WAAK,SAAS,SAAS,UAAU,KAAK;AAAA,IACzC;AAAA;AAAA,IAED,gBAAgB;AACZ,WAAK,UAAU;AACf,WAAK,YAAY;AACjB,WAAK,eAAe;AACpB,WAAK,cAAc;AACnB,WAAK,YAAY;AACjB,WAAK,SAAS;AACd,WAAK,iBAAiB;IACzB;AAAA;AAAA,IAED,gBAAgB,YAAY;AACxB,UAAI,CAAC,WAAW,KAAI;AAAI;AAExB,WAAK,iBAAiB,KAAK,eAAe;AAAA,QACtC,UAAQ,KAAK,kBAAkB,WAAW,YAAa;AAAA,MACvE;AAEY,WAAK,eAAe,QAAQ,UAAU;AAEtC,UAAI,KAAK,eAAe,SAAS,KAAK,kBAAkB;AACpD,aAAK,iBAAiB,KAAK,eAAe,MAAM,GAAG,KAAK,gBAAgB;AAAA,MAC3E;AAAA,IACJ;AAAA;AAAA,IAED,mBAAmB,OAAO;AACtB,UAAI,SAAS,KAAK,QAAQ,KAAK,eAAe,QAAQ;AAClD,aAAK,eAAe,OAAO,OAAO,CAAC;AAAA,MACtC;AAAA,IACJ;AAAA;AAAA,IAED,qBAAqB;AACjB,WAAK,iBAAiB;IACzB;AAAA;AAAA,IAED,UAAU;AACN,aAAO,KAAK,cAAc;AAAA,IAC7B;AAAA,EACJ;AAAA,EACD,SAAS;AAAA;AAAA,IAEL,UAAU,CAAC,WAAW;AAAA,MAClB,SAAS,MAAM;AAAA,MACf,WAAW,MAAM;AAAA,MACjB,cAAc,MAAM;AAAA,MACpB,aAAa,MAAM;AAAA,MACnB,WAAW,MAAM;AAAA,MACjB,QAAQ,MAAM;AAAA,IAC1B;AAAA;AAAA,IAEQ,YAAY,CAAC,UAAU;AACnB,YAAM,YAAY,CAAC,KAAK,KAAK,IAAI;AACjC,aAAO,UAAU,MAAM,WAAW,KAAK;AAAA,IAC1C;AAAA;AAAA,IAED,mBAAmB,CAAC,UAAU,MAAM;AAAA,EACvC;AAAA;AAAA,EAED,SAAS;AAAA,IACL,SAAS;AAAA,IACT,YAAY;AAAA,MACR;AAAA,QACI,KAAK;AAAA,QACL,SAAS;AAAA,QACT,OAAO,CAAC,WAAW,aAAa,gBAAgB,eAAe,aAAa,UAAU,gBAAgB;AAAA,MACzG;AAAA,IACJ;AAAA,EACJ;AACL,CAAC;;"}